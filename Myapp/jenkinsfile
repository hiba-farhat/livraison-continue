pipeline {
    agent any

    stages {
        stage('----Git hub pull stage ---- ') {
            steps {
                script{
                    checkout([$class: 'GitSCM' , branches: [[name: '*/master']] ,
                       userRemoteConfigs: [[
                           credentialsId: 'git-credentials',
                           url :'https://github.com/hiba-farhat/Projet-CD.git']]])
                }
            
            }
        }
        stage('-- build --') {
		steps {
			script{

				  sh "ansible-playbook Myapp/ansible/build.yml -i Myapp/ansible/inventory/host.yml -e ansible_become_password=root"
				  
				}
			      }
			  }
			  
         stage('---- Create docker image ---- ') {
            steps {
                script{
                    sh "ansible-playbook Myapp/ansible/docker.yml -i Myapp/ansible/inventory/host.yml -e ansible_become_password=root"
                }
              }
           }
            stage('---Login to Dockerhub---') {
     steps {
       sh 'docker login -u hibafh -p hiba.712998H'
     }
     }
      stage('---push image to dockerhub---') {
     steps {
        script{
          sh "ansible-playbook Myapp/ansible/docker-registry.yml -i Myapp/ansible/inventory/host.yml -e ansible_become_password=root "
        }
     }
     }
           stage('---install promethus grafana--') {
     steps {
        script{
          sh "ansible-playbook /var/lib/jenkins/workspace/CD-project/Myapp/ansible/test.yml -i /var/lib/jenkins/workspace/CD-project/Myapp/ansible/inventory/host.yml -e ansible_become_password=root -vvv"
        }
     }
     }
     
     
        
}
}
